<html>

<head>
  <title>Narrative Project</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/vega-tooltip/0.4.2/vega-tooltip.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="style.css">
</head>

<body onload='init()'>
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand">Carbon Footprint</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a>Total GHG and Total population</a></li>
          <li><a href="barchart2.html">Different contributors to GHG emissions</a></li>
          <li><a href="linegraph2.html">Total GHG growth in 20 years</a></li>
        </ul>
      </div>
    </div>
  </nav>


  <div class="container">
    <br>
    <br>
    <div class="page-header">
      <h1></h1>
    </div>
    <p class="lead">
      Based on the dataset, we can see that there is a close correlation between the Total Greenhouse gases (GHG)
      emissions and growth of population.
    </p>
    <br>
    <div id="scatter">
      <svg width=1200 height=800>
        <!-- <g class="scatterplot"></g>
            <g class="slider"></g> -->
      </svg>
    </div>
    <div>
      <p id="analysis">A carbon footprint is the total amount of greenhouse gases (including carbon dioxide and methane)
        that are generated by our actions. Population growth, along with increasing consumption, tends to increase
        emissions of
        climate-changing greenhouse gases. Rapid population growth worsens the impacts of climate change by straining
        resources
        and exposing more people to climate-related risksâ€”especially in low-resource regions.
        <strong>Click on the Year below the chart for which you want to see the data to observe the change in total GHG
          and population.</strong>
      </p>
      <div id="radio">
        <span> <b>Select the report type: </b></span>
        <br>
        <br>
        <label for="populationvsghg">
          <input type="radio" id="population" name="reportType" />
          <span>Total GHG and population </span>
          <a href="ProjectWithNavigation.html"></a>
        </label>
        <br>
        <br>
        <label for="gdpvsghg">
          <input type="radio" id="GDP" name="reportType" />
          <span>Total GHG and GDP </span>
          <a href="page2.html"></a>
        </label>
        <br>


      </div>
      <div id="button">
        <p>To check the different contributors to GHG click Next</p>
        <!-- <button type="button">Next</button> -->
        <a href="barchart2.html">Next &raquo;</a>
      </div>
    </div>
    <!-- <div id="button">
        <button id="play-button">Play</button>
      </div> -->
  </div>

  <!-- <ul class="pager">
      <li><a href="">Previous</a></li>
      <li><a href="">Next</a></li>
    </ul> -->

  <footer class="footer">
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.6.0/d3.min.js"></script>
  <script src='https://d3js.org/d3.v5.min.js'></script>
  <script src=" https://d3-annotation.susielu.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>

  <script>
    async function init() {
      d3.csv("https://unnatihasija1.github.io/GHGEmissionsData.csv").then(function (dataset) {
        d = dataset;
        var formatInteger = d3.format(",");
        var formatDecimal = d3.format(",.2f");
        prevselecteddata = [];

        scatter_plot(d);
      }
      )

      function scatter_plot(d) {

        let country_select = []

        // for axes
        let maxTotalGHG = 0
        let maxPopulation = 0
        let minTotalGHG = 0
        let minPopulation = 0

        //find the minimum and maximum for x and y axis

        for (i = 0; i < d.length; i++) {
          total_ghg = Number(d[i]["total_ghg"]);
          population = Number(d[i]["population"]);
          if (total_ghg > maxTotalGHG) maxTotalGHG = total_ghg;
          if (population > maxPopulation) maxPopulation = population;
        }
        // reset values
        total_ghg = 0;
        population = 0;
        for (i = 0; i < d.length; i++) {
          total_ghg = Number(d[i]["total_ghg"]);
          population = Number(d[i]["population"]);
          if (total_ghg < minTotalGHG) minTotalGHG = total_ghg;
          if (population < minPopulation) minPopulation = population;
        }


        var y = d3.scaleLog().domain([50000, 1500000000]).range([500, 0]);
        var x = d3.scaleLog().domain([0.1, 10000]).range([0, 500]);
        // var c = d3.scaleOrdinal(d3.scale.category20());


        var userselectedyear = 2005;
        // document.getElementById("Year").innerHTML = document.getElementById("Slider").value;
        // document.getElementById("Slider").onchange = 
        // function(userselectedyear) {
        // document.getElementById("Year").innerHTML = this.value;
        // return this.value }
        // if (d.year=[]){
        //     userselectedyear=d.year
        // }

        var selectedYearData = d.filter(function (e) { return (e.year == d[0].year) })
        selectedYearData = selectedYearData.filter(function (e) { return (e.population > 300000) })
        var c = d3.scaleOrdinal().domain([selectedYearData.country]).range(['red', '#04AA6D', '#af9358'])

        var margin = 50;
        var height = 400;
        var tooltip = d3.select("svg")
          //.select("g")
          //.attr("class", "scatterplot")

          .data(selectedYearData)
          .enter()
          .append("div")
          .style("opacity", 0)
          .attr("class", "tooltip")
          .style("background-color", "lightblue")
          .style("border", "solid")
          .style("border-width", "1px")
          .style("border-radius", "5px")
          .style("padding", "10px")
          .style("position", "absolute")
          .style("width", "auto")
          .style("height", "auto")

        var mouseover = function (selectedYearData) {
          d3.select(this).transition()
            .duration('200')
            .attr("r", 9);
          tooltip
            .html("Country:" + selectedYearData.country + "<br>  Population:" + d3.format("0.2f")(selectedYearData.population) + "<br> Total GreenHouseGas Emissions" + d3.format("0.2f")(selectedYearData.total_ghg))
            .style("left", (d3.event.pageX) + "px")
            .style("top", (d3.event.pageY) + "px")
            .style("left", (d3.mouse(this)[0] + 250) + "px")
            .style("top", (d3.mouse(this)[1] + 230) + "px")
            .style("opacity", 1)
        }


        // A function that change this tooltip when the leaves a point: just need to set opacity to 0 again
        var mouseleave = function (selectedYearData) {
          d3.select(this).transition()
            .duration('100')
            .attr("r", 5);
          tooltip
            .transition()
            .duration(200)
            .style("opacity", 0)
        }

        var plot = d3.select("svg").append("g")
          .attr("class", "scatterplot")
          .attr("transform", "translate(100,100)");

        // var circleplot = d3.select("svg").append("g").selectAll("circle").data(prevselecteddata);
        // circleplot.exit().remove();


        plot.selectAll("circle")
          .data(selectedYearData)
          .enter()
          .append("circle")
          .attr("cy", function (selectedYearData, i) { return y(selectedYearData.population) })
          .attr("cx", function (selectedYearData, i) { return x(selectedYearData.total_ghg) })
          .attr("r", 5)
          .on("mouseover", mouseover)
          .on("mouseleave", mouseleave)
          .attr("fill", (d) => c(d.country))
        //.style("fill", function(selectedYearData){ return c(selectedYearData)});

        // d3.select("svg").append("g").exit()
        //             .transition(750)
        //             .attr("c", 0)
        //             .attr("cy", 0)
        //             .style("opacity", 0.2)
        //             .remove();
        d3.select("svg")
          .append("g")
          .attr("transform", "translate(100,50)")
          .call(d3.axisLeft(y).tickValues([100000, 1000000, 10000000, 100000000, 1000000000]).tickFormat(d3.format(".2s")));
        //.tickValues([0,20,40,60,80,100])
        d3.select("svg")
          .append("g")
          .attr("transform", "translate(100, 550)")
          .call(d3.axisBottom(x).tickSize(10)
            .tickValues([0.1, 1, 10, 100, 1000, 5000, 10000]).tickFormat(d3.format(".2s")));


        d3.select("svg")
          .append("g")
          .append("text")
          .attr("y", 550 + 50)
          .attr("x", 360)
          .attr("font-size", "15px")
          .attr("text-anchor", "middle")
          .text("Greenhouse gases emission in tons (log values)")

        d3.select("svg")
          .append("g")
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 50)
          .attr("x", -300)
          .attr("font-size", "15px")
          .attr("text-anchor", "middle")
          .text("Population (log values)")

        //circleplot.exit().remove();
        prevselecteddata = selectedYearData;
        const annotations = [

          {
            note: {
              label: "China, India and USA are major contributors towards Total GHG ",
              //title: "Linear GHG increase",
              wrap: 200,
              align: "right"

            },

            connector: {
              end: "arrow" // 'dot' also available
            },

            x: 600,
            y: 100,
            dy: -50,
            dx: 80,
            className: "M1"
          },
        //   }].map(function (d) { d.color = "Black"; return d })
        // const annotations2 = [
          {
          note: {
            label: " are the least contributors towards Total Greenhouse gases",
            // title: "Linear GHG decline",
            wrap: 150,
            align: "right"

          },

          connector: {
            end: "arrow" // 'dot' also available
          },

          x: 200,
          y: 500,
          dy: -35,
          dx: -110,
          className: "M1"
        }

        ].map(function (d) { d.color = "#04AA6D"; return d })



        const makeAnnotations = d3.annotation()
          .type(d3.annotationLabel)
          .annotations(annotations)
        // const makeAnnotations2 = d3.annotation()
        //   .type(d3.annotationLabel)
        //   .annotations(annotations2)

        annotationsG = d3.select("svg").append("g");
        annotationsG
          //.attr("class", "annotation-group")
          .attr("class", "Most")
          .call(makeAnnotations);
        // annotationsG
        //   //.attr("class", "annotation-group")
        //   .attr("class", "Least")
        //   .call(makeAnnotations2);

        annotationsG.exit().remove;

      };


      /// slider start

      var formatDateIntoYear = d3.timeFormat("%Y");
      var formatDate = d3.timeFormat("%b %Y");
      var parseDate = d3.timeParse("%m/%d/%y");

      var startDate = new Date("2010-01-01"),
        endDate = new Date("2020-01-01");


      var svg = d3.select("svg");
      ////////// slider //////////

      var moving = false;
      var currentValue = 0;
      var targetValue = 650;

      //var playButton = d3.select("#play-button");

      var xT = d3.scaleTime()
        .domain([startDate, endDate])
        .range([0, targetValue])
        .clamp(true);

      var slider = svg.append("g")
        .attr("class", "slider")
        .attr("transform", "translate(50,650)");

      slider.append("line")
        .attr("class", "track")
        .attr("x1", xT.range()[0])
        .attr("x2", xT.range()[1])
        .select(function () { return this.parentNode.appendChild(this.cloneNode(true)); })
        .attr("class", "track-inset")
        .select(function () { return this.parentNode.appendChild(this.cloneNode(true)); })
        .attr("class", "track-overlay")
        .call(d3.drag()
          .on("start.interrupt", function () { slider.interrupt(); })
          .on("start drag", function () {
            currentValue = d3.event.x;
            update(xT.invert(currentValue));
          })
        );

      slider.insert("g", ".track-overlay")
        .attr("class", "ticks")
        .attr("transform", "translate(0," + 18 + ")")
        .selectAll("text")
        .data(xT.ticks(10))
        .enter()
        .append("text")
        .attr("x", xT)
        .attr("y", 10)
        .attr("text-anchor", "middle")
        .text(function (f) { return formatDateIntoYear(f); });

      var handle = slider.insert("rect", ".track-overlay")
        .attr("class", "handle")
        .attr("r", 9);

      var label = slider.append("text")
        .attr("class", "label")
        .attr("text-anchor", "middle")
        .text(formatDate(startDate))
        .attr("transform", "translate(0," + (-25) + ")")

      function update(h) {
        // update position and text of label according to slider scale
        handle.attr("cx", xT(h));
        label
          .attr("x", xT(h))
          .text(formatDate(h));

        // filter data set and redraw plot
        var newData = d.filter(function (d) { return (d.year == formatDateIntoYear(h)) });
        clearAll = []
        d3.selectAll("circle").data(clearAll).exit().remove()
        scatter_plot(newData);
      }


    }

  </script>



</body>
<div id="vimeo-record-extension"></div>

</html>
